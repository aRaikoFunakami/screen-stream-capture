# Commit Message Guidelines

このドキュメントは、本リポジトリにおける **コミットメッセージの詳細規約** を定義する。  
AGENTS.md に記載されたルールを **具体的にどう書くか** を示す。

---

## 1. 基本原則

### 1.1 真実性（最重要）
- 実際に行った変更のみを書く
- 推測で原因・効果を書かない  
  不確かな場合は「可能性がある」「仮説」と明示する

### 1.2 捏造禁止
- 実行していないテスト・ベンチを「実行した」と書かない
- CI が自動で実行した場合でも、**自分が確認していないなら書かない**

### 1.3 秘匿・安全
- 以下は絶対に書かない
  - APIキー、トークン、秘密鍵
  - 社内URL、内部システム名
  - 個人情報、顧客情報
  - 公開すべきでない脆弱性の詳細手順

---

## 2. フォーマット（Conventional Commits 準拠）

### 2.1 基本形式
```
type(scope): subject
```

- **type**：変更の性質
  - `feat` 新機能
  - `fix` バグ修正
  - `refactor` 振る舞いを変えない構造変更
  - `perf` 性能改善
  - `test` テスト追加・修正
  - `docs` ドキュメントのみ
  - `chore` 雑務（依存更新等）
  - `ci` CI/ワークフロー
  - `build` ビルド関連
  - `revert` 差し戻し

- **scope**：影響範囲（必須）
  - モジュール名、パッケージ名、領域名など

- **subject**：
  - 何をしたかが一目で分かる
  - 日本語・英語どちらでも可
  - 不要な修飾語を入れない

---

## 3. 本文（Body）の書き方（推奨）

本文では **Why（なぜ）** を中心に書く。

- なぜこの変更が必要だったか
- どの制約・前提があったか
- 互換性や副作用があるか

### 例
```
fix(parser): 空の属性値でpanicしないようにする

空文字列が渡された場合に unwrap していたため panic していた。
仕様上はエラーとして扱うべきなので、Result を返すように変更した。
```

---

## 4. テスト・証拠の記載ルール

### 4.1 実行した場合
- **必ずコマンドを書く**
```
Tests: cargo test -p parser (pass)
```

### 4.2 実行していない場合
```
Tests: not run (reason: local environment unavailable)
```

### 4.3 禁止表現
- `All tests passed`
- `Tests passed`
- `Verified`

（何をどう実行したか不明なため）

---

## 5. 1コミット = 1論点

- 1つのコミットで **1つの目的だけ**
- 以下を混在させない
  - `fix` + `refactor`
  - 機能追加 + 大規模整形
- 混在が避けられない場合は **コミットを分ける**

---

## 6. 参照・追跡

- Issue / PR がある場合はフッターに書く
```
Refs: #123
```

- 破壊的変更がある場合
```
BREAKING CHANGE: 設定ファイルの形式が変更された
```

---

## 7. 良い例 / 悪い例

### 良い例
```
fix(ui): モーダルが閉じない問題を修正

クリックイベントが二重登録されていたため解除した。
Tests: npm test (pass)
Refs: #456
```

### 悪い例
```
fix: bug
```

```
refactor: cleanup and fix issues
```

```
feat(core): improve performance (all tests passed)
```

---

## 8. よくある質問

### Q. テストを書けない場合は？
- まず最小再現を作る
- それでも無理なら理由を明示して未実行と書く

### Q. 日本語と英語はどちらが良い？
- どちらでも良いが **プロジェクト内で統一する**
- 形式（type/scope）は必ず守る

---

## 9. 関連ドキュメント
- AGENTS.md（最上位ルール）