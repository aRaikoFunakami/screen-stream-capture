# AGENTS.md - AI コーディングエージェント向けガイド

このドキュメントは、GitHub Copilot、Claude、Cursor などの AI コーディングエージェントが本プロジェクトを理解し、適切にコードを生成・修正するための指示書です。

---

## クイックリファレンス

> **重要**: 作業開始前に必ず [README.md](./README.md) を確認してください。

| 項目 | 内容 |
|------|------|
| **プロジェクト名** | `{PROJECT_NAME}` |
| **主要言語** | `{LANGUAGES}` |
| **フレームワーク** | `{FRAMEWORKS}` |
| **パッケージマネージャー** | `{PACKAGE_MANAGER}` |
| **テストフレームワーク** | `{TEST_FRAMEWORK}` |

---

## ⚠️ 作業前の必須確認事項

**作業を始める前に、以下のドキュメントを必ず確認すること：**

| ドキュメント | 確認するタイミング |
|-------------|-------------------|
| **[README.md](./README.md)** | プロジェクト全体の把握、セットアップ方法 |
| **[CONTRIBUTING.md](./CONTRIBUTING.md)** | コントリビューションガイドライン |
| **[docs/](./docs/)** | 詳細なドキュメント（存在する場合） |

**重要**: 一般的なフレームワークの知識だけで推測して作業しないこと。プロジェクト固有のルールや設定を必ず確認してください。

---

## プロジェクト概要

### 説明

`{PROJECT_DESCRIPTION}`

### アーキテクチャ

```
{ARCHITECTURE_DIAGRAM}
```

---

## ディレクトリ構造

```
project-root/
├── AGENTS.md                # 本ファイル（AI向けガイド）
├── README.md                # プロジェクト概要
├── src/                     # ソースコード
├── work/                    # 一時的な設計書・計画書
├── tests/                   # テストコード
├── docs/                    # ドキュメント
└── config/                  # 設定ファイル
```

---

## 開発ガイド

### セットアップ

```bash
# 依存関係のインストール
{INSTALL_COMMAND}

# 開発サーバーの起動
{DEV_COMMAND}

# テストの実行
{TEST_COMMAND}
```

### 依存関係管理

```bash
# パッケージの追加
{ADD_PACKAGE_COMMAND}

# 開発用パッケージの追加
{ADD_DEV_PACKAGE_COMMAND}
```

### Python 依存関係管理（uv 必須）

Python の依存関係管理には **必ず uv を使用すること**。pip や poetry ではなく uv を使うことで、どの環境でも再現可能な依存関係を保証する。

```bash
# ライブラリの追加（必ず uv add を使用）
uv add <package-name>

# 開発用ライブラリの追加
uv add --dev <package-name>

# 依存関係の同期
uv sync

# Python スクリプトの実行
uv run python script.py

# pytest の実行
uv run pytest tests/ -v
```

#### ⚠️ 禁止事項

- `pip install` を直接使用しない
- `requirements.txt` を手動で編集しない
- `pyproject.toml` の dependencies を手動で編集しない（uv add が自動管理）

#### uv を使う理由

1. **再現性**: `uv.lock` により全環境で同一のパッケージバージョンを保証
2. **高速**: pip より 10-100 倍高速なインストール
3. **一貫性**: Python バージョンと依存関係を一元管理

---

## コーディング規約

### 全般

- **型安全性**: 可能な限り型を明示的に定義する
- **ドキュメント**: 公開 API には必ず docstring/JSDoc を記述する
- **テスト**: 新機能や修正には必ずテストを追加する
- **コミット**: 1 つの論理的な変更につき 1 コミット
- **非同期処理**: async/await を活用し、ブロッキング処理を避ける
- **王道の設計**: 奇をてらわず、標準的・王道のデザインパターンと設計手法を採用する
- **既存ライブラリの活用**: 車輪の再発明を避け、実績のあるライブラリを積極的に利用する

### 命名規則

| 種類 | 規則 | 例 |
|------|------|-----|
| 変数・関数 | camelCase または snake_case | `getUserData`, `get_user_data` |
| クラス | PascalCase | `UserManager` |
| 定数 | UPPER_SNAKE_CASE | `MAX_RETRY_COUNT` |
| ファイル | kebab-case または snake_case | `user-manager.ts`, `user_manager.py` |

### コードスタイル

```typescript
// TypeScript の例

// 型を明示的に定義
interface UserData {
  id: string;
  name: string;
  email: string;
}

// 関数には引数と戻り値の型を指定
function getUser(id: string): Promise<UserData> {
  // ...
}

// コンポーネントはアロー関数で定義
const UserCard: React.FC<Props> = ({ user }) => {
  // ...
};
```

```python
# Python の例

# 型ヒントを使用
def get_user(user_id: str) -> dict:
    """ユーザー情報を取得する

    Args:
        user_id: ユーザーID

    Returns:
        ユーザー情報の辞書
    """
    ...
```

---

## 禁止事項

以下の行為は **禁止** です：

1. **テストなしでコードを変更しない**
   - 新機能や修正には必ずテストを追加

2. **ドキュメントを更新せずに API を変更しない**
   - API の変更時は関連ドキュメントも更新

3. **ハードコードされた値を使用しない**
   - 環境変数または設定ファイルを使用

4. **プラットフォーム固有のコードを書かない**
   - 必要な場合は適切に抽象化する

5. **計画せずに大規模な変更を始めない**
   - 大規模なリファクタリングは計画書を作成してから実行

---

## 開発ワークフロー

### 基本サイクル

```
1. 課題/タスクを確認
   └─ 何を実装するか明確にする

2. 関連コードを調査
   └─ 既存の実装パターンを理解

3. 実装
   └─ 既存のコードスタイルに従う

4. テストを追加・実行
   └─ 全テストがパスすることを確認

5. コミット
   └─ 意味のあるコミットメッセージ
```

### 大規模な変更のワークフロー

1. **計画書を作成**
   - `work/{feature_name}/plan.md` に計画を記述
   - 目的、変更範囲、リスクを明記

2. **ユーザーの承認を得る**
   - 計画の確認前に実装を開始しない

3. **段階的に実装**
   - 1 ステップごとに動作確認
   - 小さなコミットを積み重ねる

4. **ドキュメントを更新**
   - 完了後、`docs/` に成果物の説明を追加

---

## テスト

### テストの実行

```bash
# 全テスト実行
{TEST_ALL_COMMAND}

# 特定のテストファイル
{TEST_FILE_COMMAND}

# カバレッジレポート
{TEST_COVERAGE_COMMAND}
```

### テストの書き方

- **ユニットテスト**: 単一の関数/クラスをテスト
- **インテグレーションテスト**: コンポーネント間の連携をテスト
- **E2E テスト**: ユーザーシナリオ全体をテスト

---

## トラブルシューティング

### よくある問題

| 症状 | 原因 | 対処 |
|------|------|------|
| 依存関係エラー | パッケージの不整合 | `{CLEAN_INSTALL_COMMAND}` |
| ビルドエラー | キャッシュの問題 | `{CLEAN_BUILD_COMMAND}` |
| テスト失敗 | 環境の差異 | 環境変数を確認 |

### デバッグ手順

1. **エラーメッセージを確認**
   - スタックトレースを読む
   - 関連するコードを特定

2. **最小再現手順を作成**
   - 問題を再現する最小限のコードを作成

3. **ログを追加**
   - 問題箇所の前後にログを追加
   - 変数の状態を確認

---

## 🔧 リファクタリング・新機能開発のワークフロー

大規模なリファクタリングや新機能開発を行う際は、以下のワークフローに従ってください。

### 1. 一時作業ディレクトリの作成

```bash
mkdir -p work/<feature_name>/
```

例: `work/dialog_mode_refactoring/`

### 2. 設計書・計画書の作成

`work/<feature_name>_<作成日時>/` に以下を作成:
- `design.md` - 設計書（目的、アーキテクチャ、変更点）
- `plan.md` - 作業計画（フェーズ分割、TODO管理）
- `notes.md` - 調査メモ、気づき等

### 3. 実装を進めながら進捗を更新

計画書のTODOを更新しながら実装を進める。

### 4. 完了後の整理

1. **最終成果物の説明書を `docs/` に作成**
   - 実装した機能の使い方
   - API リファレンス
   - 例: `docs/analysis_agents.md`

2. **一時作業ディレクトリを削除扱いにする**
   ```bash
   mv work/<feature_name>_<作成日時> work/<feature_name>_<作成日時>_<終了日時>/
   ```

### ディレクトリの使い分け

| ディレクトリ | 目的 | Git管理 |
|-------------|------|---------|
| `work/` | 設計書・計画書・進捗管理 | 含む（変更追跡のため） |
| `docs/` | 最終成果物の説明書 | 含む |

**注意**: `work/` 内のファイルも Git で管理します。LLM が計画の変更履歴を追跡し、セッション間で継続的に開発を進めるためです。
完成した機能のドキュメントは `docs/` にも残してください。

---

## 環境変数

| 変数名 | 説明 | デフォルト値 |
|--------|------|-------------|
| `NODE_ENV` | 実行環境 | `development` |
| `DEBUG` | デバッグモード | `false` |
| `API_URL` | API エンドポイント | `http://localhost:3000` |

---

## 参考リンク

### プロジェクト内ドキュメント

- [README.md](./README.md) - プロジェクト概要
- [CONTRIBUTING.md](./CONTRIBUTING.md) - コントリビューションガイド

### 外部ドキュメント

- `{EXTERNAL_DOCS_LINKS}`

---

## カスタムセクション

> **Note**: このセクションにはプロジェクト固有のガイドラインを追加してください。

### 例: 状態管理アーキテクチャ

```
{STATE_MANAGEMENT_DIAGRAM}
```

### 例: API 変更時のチェックリスト

- [ ] API 仕様書を更新した
- [ ] テストを追加した
- [ ] クライアントコードを更新した
- [ ] 変更履歴を記録した

---

## 更新履歴

| 日付 | 変更内容 |
|------|----------|
| `{DATE}` | 初版作成 |

---

## 使い方

このテンプレートを使用する際は、以下のプレースホルダーをプロジェクトに合わせて置き換えてください：

| プレースホルダー | 説明 |
|-----------------|------|
| `{PROJECT_NAME}` | プロジェクト名 |
| `{LANGUAGES}` | 使用言語（TypeScript, Python など） |
| `{FRAMEWORKS}` | フレームワーク（React, FastAPI など） |
| `{PACKAGE_MANAGER}` | パッケージマネージャー（npm, uv, pip など） |
| `{TEST_FRAMEWORK}` | テストフレームワーク（Jest, pytest など） |
| `{PROJECT_DESCRIPTION}` | プロジェクトの説明 |
| `{ARCHITECTURE_DIAGRAM}` | アーキテクチャ図（ASCII アート） |
| `{INSTALL_COMMAND}` | インストールコマンド |
| `{DEV_COMMAND}` | 開発サーバー起動コマンド |
| `{TEST_COMMAND}` | テスト実行コマンド |
| `{ADD_PACKAGE_COMMAND}` | パッケージ追加コマンド |
| `{ADD_DEV_PACKAGE_COMMAND}` | 開発用パッケージ追加コマンド |
| `{TEST_ALL_COMMAND}` | 全テスト実行コマンド |
| `{TEST_FILE_COMMAND}` | 特定ファイルのテストコマンド |
| `{TEST_COVERAGE_COMMAND}` | カバレッジレポートコマンド |
| `{CLEAN_INSTALL_COMMAND}` | クリーンインストールコマンド |
| `{CLEAN_BUILD_COMMAND}` | クリーンビルドコマンド |
| `{EXTERNAL_DOCS_LINKS}` | 外部ドキュメントリンク |
| `{STATE_MANAGEMENT_DIAGRAM}` | 状態管理図 |
| `{DATE}` | 日付 |

不要なセクションは削除し、プロジェクトに必要なセクションを追加してください。
